# 🚀 部署指南

本文档介绍如何将"我们的时光书"应用部署到互联网上,让你可以随时随地访问。

## 📋 部署方式对比

| 平台                 | 难度      | 费用 | 特点                             | 推荐指数   |
| -------------------- | --------- | ---- | -------------------------------- | ---------- |
| **Vercel**           | ⭐ 简单   | 免费 | 自动部署、速度快、支持自定义域名 | ⭐⭐⭐⭐⭐ |
| **Netlify**          | ⭐ 简单   | 免费 | 功能丰富、CI/CD 支持             | ⭐⭐⭐⭐⭐ |
| **GitHub Pages**     | ⭐⭐ 中等 | 免费 | 需要配置路由、适合静态站点       | ⭐⭐⭐⭐   |
| **Cloudflare Pages** | ⭐ 简单   | 免费 | CDN 加速、速度极快               | ⭐⭐⭐⭐⭐ |

---

## 🌟 方案一: Vercel 部署 (推荐)

Vercel 是最简单快捷的部署方式,特别适合 React + Vite 项目。

### 步骤 1: 准备工作

1. 注册 [Vercel 账号](https://vercel.com) (可用 GitHub 登录)
2. 确保项目已推送到 GitHub 仓库

### 步骤 2: 部署项目

#### 方法 A: 通过 Vercel 网站部署

1. 登录 [Vercel Dashboard](https://vercel.com/dashboard)
2. 点击 **"Add New Project"**
3. 选择 **"Import Git Repository"**
4. 授权并选择你的 GitHub 仓库
5. 配置项目:
   - **Framework Preset**: Vite
   - **Build Command**: `npm run build`
   - **Output Directory**: `dist`
6. 添加环境变量:
   - 点击 **"Environment Variables"**
   - 添加 `ZHIPU_API_KEY` = `你的智谱AI密钥`
7. 点击 **"Deploy"**

#### 方法 B: 通过命令行部署

```bash
# 1. 安装 Vercel CLI
npm install -g vercel

# 2. 登录 Vercel
vercel login

# 3. 部署项目
vercel

# 4. 生产环境部署
vercel --prod
```

### 步骤 3: 配置环境变量

> ⚠️ **重要**: 必须在 Vercel 中配置 API Key,否则 AI 功能无法使用

1. 进入项目的 **Settings** → **Environment Variables**
2. 添加变量:
   - **Name**: `ZHIPU_API_KEY`
   - **Value**: `你的智谱AI密钥`
   - **Environment**: 选择 `Production`, `Preview`, `Development`
3. 点击 **Save**
4. 重新部署项目(Vercel 会自动触发)

### 步骤 4: 访问网站

部署成功后,Vercel 会提供一个域名,如:

```
https://your-project-name.vercel.app
```

---

## 🎯 方案二: Netlify 部署

### 步骤 1: 准备工作

1. 注册 [Netlify 账号](https://www.netlify.com)
2. 确保项目已推送到 GitHub

### 步骤 2: 部署

1. 登录 [Netlify Dashboard](https://app.netlify.com)
2. 点击 **"Add new site"** → **"Import an existing project"**
3. 选择 **GitHub** 并授权
4. 选择你的仓库
5. 配置构建设置:
   - **Build command**: `npm run build`
   - **Publish directory**: `dist`
6. 添加环境变量:
   - 点击 **"Show advanced"** → **"New variable"**
   - 添加 `ZHIPU_API_KEY` = `你的智谱AI密钥`
7. 点击 **"Deploy site"**

### 步骤 3: 配置重定向

创建 `public/_redirects` 文件(如果没有):

```
/*    /index.html   200
```

这样可以确保单页应用的路由正常工作。

---

## 📦 方案三: GitHub Pages 部署

### 步骤 1: 修改 Vite 配置

编辑 `vite.config.ts`:

```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

export default defineConfig({
  plugins: [react()],
  base: "/your-repo-name/", // 替换为你的仓库名
});
```

### 步骤 2: 安装 gh-pages

```bash
npm install --save-dev gh-pages
```

### 步骤 3: 修改 package.json

添加部署脚本:

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "deploy": "npm run build && gh-pages -d dist"
  }
}
```

### 步骤 4: 部署

```bash
npm run deploy
```

### 步骤 5: 配置 GitHub Pages

1. 进入 GitHub 仓库的 **Settings** → **Pages**
2. **Source** 选择 `gh-pages` 分支
3. 点击 **Save**

访问地址: `https://your-username.github.io/your-repo-name/`

> ⚠️ **注意**: GitHub Pages 不支持环境变量,需要在代码中硬编码 API Key(不推荐)或使用其他方案。

---

## ☁️ 方案四: Cloudflare Pages

### 步骤 1: 准备工作

1. 注册 [Cloudflare 账号](https://dash.cloudflare.com)
2. 进入 **Pages** 页面

### 步骤 2: 部署

1. 点击 **"Create a project"**
2. 连接 GitHub 并选择仓库
3. 配置构建设置:
   - **Framework preset**: Vite
   - **Build command**: `npm run build`
   - **Build output directory**: `dist`
4. 添加环境变量:
   - `ZHIPU_API_KEY` = `你的智谱AI密钥`
5. 点击 **"Save and Deploy"**

---

## 🔐 环境变量配置说明

### Vite 环境变量规则

> ⚠️ **重要**: Vite 只会暴露以 `VITE_` 开头的环境变量到客户端代码

如果你的代码中使用 `import.meta.env.ZHIPU_API_KEY`,需要修改为:

1. **修改 `.env.local`**:

   ```env
   VITE_ZHIPU_API_KEY=你的智谱AI密钥
   ```

2. **修改代码中的引用**:

   ```typescript
   // 将所有 import.meta.env.ZHIPU_API_KEY 改为
   import.meta.env.VITE_ZHIPU_API_KEY;
   ```

3. **在部署平台配置环境变量时**:
   - 变量名改为 `VITE_ZHIPU_API_KEY`

---

## 🛠️ 本地构建测试

在部署前,建议先在本地测试构建:

```bash
# 1. 构建项目
npm run build

# 2. 预览构建结果
npm run preview
```

访问 `http://localhost:4173` 检查是否正常运行。

---

## 📱 自定义域名

所有平台都支持绑定自定义域名:

### Vercel

1. 进入项目 **Settings** → **Domains**
2. 添加你的域名
3. 按照提示配置 DNS 记录

### Netlify

1. 进入 **Domain settings**
2. 点击 **Add custom domain**
3. 配置 DNS

### Cloudflare Pages

1. 进入 **Custom domains**
2. 添加域名并自动配置 DNS

---

## ✅ 部署检查清单

- [ ] 项目能在本地正常运行 (`npm run dev`)
- [ ] 本地构建成功 (`npm run build`)
- [ ] 环境变量已正确配置
- [ ] AI 功能测试通过
- [ ] 数据导入/导出功能正常
- [ ] 移动端适配正常
- [ ] 所有页面路由正常

---

## 🐛 常见问题

### Q1: 部署后 AI 功能不可用?

**A**: 检查环境变量是否正确配置:

- Vercel/Netlify: 在平台设置中添加 `VITE_ZHIPU_API_KEY`
- 确保变量名以 `VITE_` 开头
- 重新部署项目

### Q2: 页面刷新后 404?

**A**: 需要配置重定向规则:

- **Vercel**: 自动处理
- **Netlify**: 创建 `public/_redirects` 文件
- **GitHub Pages**: 使用 Hash 路由或配置 404.html

### Q3: 图片无法显示?

**A**: 检查图片链接是否为绝对路径,或使用图床服务。

### Q4: 构建失败?

**A**: 检查:

- Node.js 版本是否 >= 18
- 依赖是否完整安装
- 构建命令是否正确

---

## 🎉 推荐部署流程

**最简单的方式 (5 分钟完成)**:

1. ✅ 将代码推送到 GitHub
2. ✅ 注册 Vercel 账号(用 GitHub 登录)
3. ✅ 导入 GitHub 仓库
4. ✅ 添加环境变量 `VITE_ZHIPU_API_KEY`
5. ✅ 点击部署,完成!

部署成功后,你就可以通过互联网访问你的"时光书"了! ✨

---

**有任何问题欢迎随时询问!** 💝
